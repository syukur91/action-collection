name: functionbeat-testing
on: [push]

jobs:
 push-action:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout public repo
      id: checkout
      uses: actions/checkout@master

    - name: Download the function beat binary
      id: binary      
      run: curl -L -O https://artifacts.elastic.co/downloads/beats/functionbeat/functionbeat-7.4.1-linux-x86_64.tar.gz && tar xvzf functionbeat-7.4.1-linux-x86_64.tar.gz && mv functionbeat-7.4.1-linux-x86_64 functionbeat && ls -al

    - name: Deploy the functionbeat
      id: deploy
      continue-on-error: true
      # run: ./functionbeat -v -e -d "*" deploy my-fucking-functionbeat-logs && echo "::set-output name=functionbeat_status::success" ||   echo "::set-output name=functionbeat_status::failure"
      run: if [[ $(./functionbeat -v -e -d "*" deploy my-fucking-functionbeat-logs)  > 0 ]] ; then  echo "::set-output name=functionbeat_status::success"; else echo "::set-output name=functionbeat_status::failure" ; fi
      working-directory: functionbeat

    - name: Dump steps context
      id: dump      
      env:
        STEPS_CONTEXT: ${{ toJson(steps.deploy.outputs) }}
      run: echo "$STEPS_CONTEXT"

    - name: List the file
      continue-on-error: true  
      if: steps.deploy.outputs.status == 'success'
      id: list      
      run: echo "hello"
      working-directory: functionbeat